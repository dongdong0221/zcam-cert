<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›·ç‰¹ç»é”€å•†æˆæƒè¯ä¹¦åˆ¶ä½œ (2026)</title>
    
    <style>
        /* å…¨å±€æ ·å¼ï¼šæ·±è‰²ä¸“ä¸šé£æ ¼ */
        body { font-family: "Microsoft YaHei", sans-serif; background-color: #2b2b2b; color: #eee; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; height: 100vh; box-sizing: border-box; }
        
        /* å¸ƒå±€å®¹å™¨ */
        .main-container { display: flex; flex-direction: row; gap: 30px; width: 100%; max-width: 1400px; height: 100%; overflow: hidden; }
        
        /* å·¦ä¾§æ§åˆ¶æ  */
        .controls { flex: 0 0 340px; background: #3a3a3a; padding: 20px; border-radius: 12px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; height: fit-content; max-height: 90vh; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* å³ä¾§é¢„è§ˆåŒº */
        .preview-area { flex: 1; background: #1f1f1f; border-radius: 12px; display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px dashed #555; position: relative; overflow: hidden; }
        
        /* ç”»å¸ƒæ ·å¼ */
        canvas { max-width: 100%; max-height: 100%; box-shadow: 0 0 30px rgba(0,0,0,0.5); object-fit: contain; cursor: grab; transition: transform 0.1s; }
        canvas:active { cursor: grabbing; transform: scale(0.99); }

        /* æ§ä»¶ç»„é€šç”¨æ ·å¼ */
        .group { background: #444; padding: 15px; border-radius: 8px; border: 1px solid #555; position: relative; }
        .group-title { font-size: 14px; color: #d4af37; margin-bottom: 12px; font-weight: bold; border-bottom: 1px solid #555; padding-bottom: 8px; letter-spacing: 1px; }
        
        label { display: block; font-size: 12px; color: #bbb; margin-top: 10px; margin-bottom: 4px; }
        input[type="text"] { width: 100%; padding: 8px; background: #222; border: 1px solid #555; color: white; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        input[type="text"]:focus { border-color: #d4af37; outline: none; }
        input[type="range"] { width: 100%; margin: 5px 0; cursor: pointer; accent-color: #d4af37; }

        /* æ¨¡ç‰ˆç½‘æ ¼ */
        .template-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .template-item { cursor: pointer; border-radius: 6px; overflow: hidden; border: 2px solid transparent; position: relative; background: #222; height: 60px; }
        .template-item img { width: 100%; height: 100%; object-fit: cover; display: block; opacity: 0.6; transition: 0.2s; }
        .template-item:hover { border-color: #888; }
        .template-item:hover img { opacity: 0.9; }
        
        /* é€‰ä¸­çŠ¶æ€ */
        .template-item.active { border-color: #d4af37; box-shadow: 0 0 10px rgba(212, 175, 55, 0.4); }
        .template-item.active img { opacity: 1; }
        
        .template-name { font-size: 10px; text-align: center; color: #fff; width: 100%; background: rgba(0,0,0,0.6); position: absolute; bottom: 0; padding: 2px 0; pointer-events: none;}

        /* æŒ‰é’® */
        .btn-download { background: linear-gradient(135deg, #d4af37 0%, #b48f27 100%); color: #111; font-weight: bold; padding: 15px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: 0.2s; }
        .btn-download:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.3); filter: brightness(1.1); }
        .btn-download:active { transform: translateY(0); }

        .btn-manual { background: transparent; border: 1px dashed #777; color: #aaa; width: 100%; padding: 8px; border-radius: 4px; cursor: pointer; text-align: center; font-size: 12px; margin-top: 10px; transition: 0.2s; }
        .btn-manual:hover { border-color: #ccc; color: white; background: rgba(255,255,255,0.05); }

    </style>
</head>
<body>

    <div class="main-container">
        <div class="controls">
            <h2 style="color:#d4af37; margin:0; text-align:center;">ğŸ† ç»é”€å•†æˆæƒè¯ä¹¦åˆ¶ä½œå·¥å…·</h2>
            
            <div class="group" style="border-color: #d4af37;">
                <div class="group-title">1. é€‰æ‹©è¯ä¹¦æ¨¡ç‰ˆ</div>
                <div id="templateGrid" class="template-grid"></div>
                
                <label class="btn-manual" for="bgUploader">ğŸ“‚ ä¸Šä¼ å…¶ä»–æ¨¡ç‰ˆ...</label>
                <input type="file" id="bgUploader" accept="image/*" style="display:none;">
            </div>

            <div class="group">
                <div class="group-title">2. ç¼–è¾‘å†…å®¹ (å¯ç›´æ¥æ‹–æ‹½é¢„è§ˆå›¾)</div>
                
                <label>å…¬å¸/åº—é“ºåç§°</label>
                <input type="text" id="cText" value="å…¬å¸åç§°æˆ–è€…åº—é“ºåç§°">
                
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <div style="flex:1;">
                        <label>ä¸Šä¸‹ä½ç½®</label>
                        <input type="range" id="cY" min="0" max="2000" value="0">
                    </div>
                    <div style="flex:1;">
                        <label>å­—ä½“å¤§å° <span id="val_cSize" style="color:#d4af37;">45</span></label>
                        <input type="range" id="cSize" min="20" max="150" value="45">
                    </div>
                </div>

                <hr style="border:0; border-top:1px dashed #555; margin: 15px 0;">

                <label>çº¿ä¸‹åœ°åŒº/å¤‡æ³¨ä¿¡æ¯</label>
                <input type="text" id="rText" value="åŒ—äº¬">
                
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <div style="flex:1;">
                        <label>ä¸Šä¸‹ä½ç½®</label>
                        <input type="range" id="rY" min="0" max="2000" value="0">
                    </div>
                    <div style="flex:1;">
                        <label>å·¦å³å¾®è°ƒ</label>
                        <input type="range" id="rX" min="-300" max="300" value="-100">
                    </div>
                </div>
                <label>å­—ä½“å¤§å° <span id="val_rSize" style="color:#d4af37;">42</span></label>
                <input type="range" id="rSize" min="20" max="150" value="42">
            </div>

            <button class="btn-download" onclick="downloadSingle()">â¬‡ï¸ ä¸‹è½½è¯ä¹¦å›¾ç‰‡</button>
        </div>

        <div class="preview-area">
            <canvas id="certCanvas"></canvas>
        </div>
    </div>

    <script>
        // ==========================================
        // ğŸ› ï¸ æ¨¡ç‰ˆé…ç½®åŒº (è¯·åœ¨æ­¤å¤„ç¡®è®¤å›¾ç‰‡æ–‡ä»¶å)
        // ==========================================
        const templates = [
            {
                name: "Z CAM çº¿ä¸Š",
                file: "./zcam_online.jpg",
                config: { cY: 480, cSize: 45, rY: 615, rX: -106, rSize: 42 }
            },
            {
                name: "Z CAM çº¿ä¸‹",
                file: "./zcam_offline.jpg",
                config: { cY: 480, cSize: 45, rY: 615, rX: -106, rSize: 42 }
            },
            {
                name: "ATOMOS çº¿ä¸Š",
                file: "./atomos_online.jpg",
                config: { cY: 500, cSize: 45, rY: 630, rX: 0, rSize: 40 }
            },
            {
                name: "ATOMOS çº¿ä¸‹",
                file: "./atomos_offline.jpg",
                config: { cY: 500, cSize: 45, rY: 630, rX: 0, rSize: 40 }
            },
            {
                name: "ä¼ å¥‡é›·é¸£",
                file: "./leiming.jpg",
                config: { cY: 550, cSize: 50, rY: 700, rX: 0, rSize: 45 }
            },
            {
                name: "EDIUS",
                file: "./edius.jpg",
                config: { cY: 480, cSize: 45, rY: 615, rX: 0, rSize: 42 }
            },
            {
                name: "é›·ç‰¹å­—å¹•",
                file: "./visitle.jpg",
                config: { cY: 480, cSize: 45, rY: 615, rX: 0, rSize: 42 }
            }
        ];
        // ==========================================

        const canvas = document.getElementById('certCanvas');
        const ctx = canvas.getContext('2d');
        const bgImage = new Image();
        
        // çŠ¶æ€ç®¡ç†
        const state = {
            company: { text: "", y: 0, size: 45, x: 0 },
            region: { text: "", y: 0, size: 42, xOffset: -100 }
        };

        // DOM å…ƒç´ å¼•ç”¨
        const els = {
            grid: document.getElementById('templateGrid'),
            cText: document.getElementById('cText'), cY: document.getElementById('cY'), cSize: document.getElementById('cSize'),
            rText: document.getElementById('rText'), rY: document.getElementById('rY'), rX: document.getElementById('rX'), rSize: document.getElementById('rSize'),
            bgUploader: document.getElementById('bgUploader')
        };

        // 1. åˆå§‹åŒ–ç¨‹åº
        function init() {
            // ç”Ÿæˆæ¨¡ç‰ˆåˆ—è¡¨
            els.grid.innerHTML = "";
            templates.forEach((tpl, index) => {
                const div = document.createElement('div');
                div.className = 'template-item';
                div.title = tpl.name; // é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå…¨å
                div.onclick = () => loadTemplate(index);

                const img = document.createElement('img');
                img.src = tpl.file;
                // é»˜è®¤å ä½å›¾ï¼Œé˜²æ­¢å›¾ç‰‡æœªæ‰¾åˆ°æ—¶å¤ªä¸‘
                img.onerror = () => { img.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='60' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' fill='%23333'/%3E%3Ctext x='50' y='35' font-family='Arial' font-size='10' fill='%23666' text-anchor='middle'%3Eå›¾è£‚äº†%3C/text%3E%3C/svg%3E"; };
                
                const span = document.createElement('div');
                span.className = 'template-name';
                span.innerText = tpl.name;

                div.appendChild(img);
                div.appendChild(span);
                els.grid.appendChild(div);
            });

            // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ª
            if(templates.length > 0) loadTemplate(0);
        }

        // 2. åŠ è½½æ¨¡ç‰ˆ
        function loadTemplate(index) {
            // é«˜äº®é€‰ä¸­é¡¹
            const items = document.querySelectorAll('.template-item');
            items.forEach(item => item.classList.remove('active'));
            if(items[index]) items[index].classList.add('active');

            const tpl = templates[index];
            bgImage.src = tpl.file;
            
            // åº”ç”¨é…ç½®
            state.company.y = tpl.config.cY;
            state.company.size = tpl.config.cSize;
            state.region.y = tpl.config.rY;
            state.region.xOffset = tpl.config.rX;
            state.region.size = tpl.config.rSize;
            
            bgImage.onload = () => {
                canvas.width = bgImage.width;
                canvas.height = bgImage.height;
                // æ›´æ–°æ»‘å—æœ€å¤§å€¼
                els.cY.max = bgImage.height;
                els.rY.max = bgImage.height;
                syncStateToUI();
                draw();
            };
        }

        // æ‰‹åŠ¨ä¸Šä¼ é€»è¾‘
        els.bgUploader.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                bgImage.src = event.target.result;
                document.querySelectorAll('.template-item').forEach(i => i.classList.remove('active')); // æ¸…é™¤é«˜äº®
                bgImage.onload = () => {
                     canvas.width = bgImage.width;
                     canvas.height = bgImage.height;
                     els.cY.max = bgImage.height;
                     els.rY.max = bgImage.height;
                     draw();
                }
            }
            reader.readAsDataURL(file);
        });

        // 3. æ ¸å¿ƒç»˜å›¾
        function draw() {
            if (!bgImage.complete || bgImage.naturalWidth === 0) return;
            
            // æ¸…ç©º
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // ç”»èƒŒæ™¯
            ctx.drawImage(bgImage, 0, 0);
            
            // é€šç”¨æ–‡å­—è®¾ç½®
            ctx.fillStyle = '#1a1a1a'; // æ¥è¿‘é»‘è‰²çš„æ·±ç°ï¼Œæ›´æœ‰è´¨æ„Ÿ
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            // ç”»å…¬å¸
            ctx.font = `bold ${state.company.size}px "SimHei", "Microsoft YaHei", sans-serif`;
            ctx.fillText(state.company.text, canvas.width / 2, state.company.y);

            // ç”»åœ°åŒº
            ctx.font = `bold ${state.region.size}px "SimHei", "Microsoft YaHei", sans-serif`;
            ctx.fillText(state.region.text, (canvas.width / 2) + state.region.xOffset, state.region.y);
        }

        // 4. äº¤äº’é€»è¾‘
        function handleUIChange() {
            state.company.text = els.cText.value;
            state.company.y = parseInt(els.cY.value);
            state.company.size = parseInt(els.cSize.value);
            state.region.text = els.rText.value;
            state.region.y = parseInt(els.rY.value);
            state.region.xOffset = parseInt(els.rX.value);
            state.region.size = parseInt(els.rSize.value);
            
            // æ›´æ–°æ•°å­—æ˜¾ç¤º
            document.getElementById('val_cSize').innerText = els.cSize.value;
            document.getElementById('val_rSize').innerText = els.rSize.value;
            
            draw();
        }

        function syncStateToUI() {
            els.cText.value = state.company.text;
            els.cY.value = state.company.y;
            els.cSize.value = state.company.size;
            els.rText.value = state.region.text;
            els.rY.value = state.region.y;
            els.rX.value = state.region.xOffset;
            els.rSize.value = state.region.size;
            handleUIChange();
        }

        // 5. é¼ æ ‡æ‹–æ‹½é€»è¾‘
        let isDragging = false;
        let dragTarget = null; 

        function getCanvasPos(evt) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return { x: (evt.clientX - rect.left) * scaleX, y: (evt.clientY - rect.top) * scaleY };
        }

        canvas.addEventListener('mousedown', (e) => {
            const pos = getCanvasPos(e);
            // ç®€å•çš„ç‚¹å‡»æ£€æµ‹ (Yè½´ +- 40åƒç´ èŒƒå›´)
            if (Math.abs(pos.y - state.company.y) < 40) { 
                isDragging = true; 
                dragTarget = 'company'; 
            } else if (Math.abs(pos.y - state.region.y) < 40) { 
                isDragging = true; 
                dragTarget = 'region'; 
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging || !dragTarget) return;
            const pos = getCanvasPos(e);

            if (dragTarget === 'company') { 
                state.company.y = Math.floor(pos.y); 
            } else if (dragTarget === 'region') { 
                state.region.y = Math.floor(pos.y); 
                state.region.xOffset = Math.floor(pos.x - (canvas.width / 2)); 
            }
            syncStateToUI(); // å®æ—¶æ›´æ–°ç•Œé¢
        });

        window.addEventListener('mouseup', () => { isDragging = false; dragTarget = null; });
        window.addEventListener('mouseout', () => { isDragging = false; dragTarget = null; });

        // 6. ä¸‹è½½åŠŸèƒ½
        function downloadSingle() {
            if (!bgImage.complete || bgImage.naturalWidth === 0) { alert("æ²¡æœ‰å›¾ç‰‡å†…å®¹ï¼"); return; }
            
            // ä½¿ç”¨æœ€åŸå§‹çš„ä¸‹è½½æ–¹å¼ï¼Œå…¼å®¹æ€§æœ€å¥½
            const link = document.createElement('a');
            const safeName = els.cText.value.replace(/[\\/:*?"<>|]/g, "_"); // å»æ‰éæ³•å­—ç¬¦
            link.download = `è¯ä¹¦_${safeName}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        // ç»‘å®šäº‹ä»¶
        [els.cText, els.cY, els.cSize, els.rText, els.rY, els.rX, els.rSize].forEach(el => el.addEventListener('input', handleUIChange));
        
        // å¯åŠ¨
        init();

    </script>
</body>
</html>